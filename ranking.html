<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>EasyLoan ‚Äì Loan Ranking</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: "Segoe UI", "Roboto", Arial, sans-serif;
        background: linear-gradient(135deg, #e8f5e9, #e3f2fd);
        margin: 0;
        padding: 20px;
        color: #333;
      }
      h1 {
        font-size: 2.2rem;
        font-weight: 700;
        text-align: center;
        color: #2e7d32;
        margin-bottom: 5px;
      }
      p {
        text-align: center;
        color: #555;
        font-size: 1rem;
        margin-bottom: 30px;
      }
      .buttons {
        text-align: center;
        margin-bottom: 20px;
      }
      .btn {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #1565c0;
        color: #fff;
        border: none;
        padding: 12px 24px;
        margin: 5px;
        border-radius: 30px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
      }
      .btn:hover {
        background: #0d47a1;
        transform: translateY(-2px);
      }
      .btn.secondary {
        background: #2e7d32;
      }
      .btn.secondary:hover {
        background: #1b5e20;
        transform: translateY(-2px);
      }
      .results-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        margin-top: 20px;
      }
      .bank-card {
        width: 1200px;
        max-width: 95%;
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        padding: 20px;
        transition: transform 0.3s, box-shadow 0.3s;
      }
      .bank-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
      }
      .card-header {
        display: flex;
        justify-content: space-between;
        border-bottom: 1px solid #ddd;
        padding-bottom: 8px;
        margin-bottom: 15px;
      }
      .card-header h3 {
        color: #2c3e50;
        font-size: 1.4rem;
        margin: 0;
      }
      .card-header span {
        font-weight: 500;
        color: #555;
      }
      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 12px;
        margin-bottom: 15px;
        font-size: 14px;
      }
      .info-label {
        font-weight: 600;
        color: #2e7d32;
      }
      .emi-card {
        display: flex;
        flex-wrap: wrap;
        background: linear-gradient(135deg, #4facfe, #00f2fe);
        color: white;
        padding: 14px;
        border-radius: 14px;
        margin-top: 14px;
        box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.2);
      }
      .emi-details {
        flex: 1;
        min-width: 220px;
      }
      .emi-details h4 {
        margin: 0 0 10px 0;
        font-size: 1.1rem;
        font-weight: 700;
      }
      .emi-details p {
        margin: 5px 0;
        font-size: 0.95rem;
      }
      .emi-chart {
        flex: 1;
        height: 200px;
        min-width: 160px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .tenure-box {
        text-align: center;
        margin: 20px 0;
      }
      .tenure-box input {
        width: 100px;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 14px;
        text-align: center;
        transition: border 0.3s, box-shadow 0.3s;
      }
      .tenure-box input:focus {
        outline: none;
        border-color: #1565c0;
        box-shadow: 0 0 6px rgba(21, 101, 192, 0.3);
      }
      .popup {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      .popup-content {
        background: white;
        padding: 20px;
        border-radius: 12px;
        width: 350px;
        max-width: 90%;
        text-align: center;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }
      .popup-content h3 {
        margin-bottom: 15px;
        color: #2e7d32;
      }
      .popup-content input,
      .popup-content select {
        width: 90%;
        margin: 6px 0;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 14px;
        transition: all 0.3s;
      }
      .popup-content input:focus,
      .popup-content select:focus {
        outline: none;
        border-color: #2e7d32;
        box-shadow: 0 0 6px rgba(46, 125, 50, 0.3);
      }
      .footer {
        text-align: center;
        margin-top: 40px;
        font-size: 14px;
        color: #888;
      }

      .document-list {
        background: #f1f8e9;
        padding: 10px;
        border-radius: 8px;
        font-size: 14px;
        color: #2e7d32;
      }
    </style>
  </head>
  <body>
    <h1>üè¶ EasyLoan ‚Äì Loan Ranking</h1>
    <p>
      Based on your requirement, here are the top banks ranked from best to
      worst.
    </p>

    <div class="buttons">
      <button class="btn" onclick="history.back()">‚¨Ö Back</button>
      <button class="btn secondary" onclick="openPopup()">
        ‚öô Change Requirement
      </button>
    </div>

    <div class="tenure-box">
      <label><b>Tenure (Years): </b></label>
      <input
        type="number"
        id="tenureInputBox"
        value="5"
        min="1"
        max="30"
        onchange="updateTenure()"
      />
    </div>

    <div class="results-container" id="resultsContainer"></div>

    <div class="popup" id="popupForm">
      <div class="popup-content">
        <h3>Update Requirement</h3>
        <label>Loan Type:</label><br />
        <select id="loanTypeInput"></select
        ><br />

        <label>Loan Amount (‚Çπ):</label><br />
        <input type="number" id="loanAmountInput" /><br />

        <label>Income (‚Çπ):</label><br />
        <input type="number" id="incomeInput" /><br />

        <label>CIBIL Score:</label><br />
        <input type="number" id="cibilInput" /><br />

        <button class="btn secondary" onclick="applyRequirement()">
          Apply
        </button>
        <button class="btn" onclick="closePopup()">Cancel</button>
      </div>
    </div>

    <div class="footer">EasyLoan RP Project ¬© 2025</div>

    <!-- Bank data -->
    <script src="banks.js"></script>
    <script src="bank_loan_documents.js"></script>

    <script>
      let loanType = "Personal Loan";
      let loanAmount = 2000000;
      let income = 25000;
      let cibil = 700;
      let tenure = 5;

      function calculateEMI(principal, rate, tenureYears) {
        let r = rate / 12 / 100;
        let n = tenureYears * 12;
        let emi =
          (principal * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
        let totalPayment = emi * n;
        let interest = totalPayment - principal;
        return {
          emi: Math.round(emi),
          total: Math.round(totalPayment),
          interest: Math.round(interest),
        };
      }

      function rankLoans() {
        let filtered = banks.filter(
          (b) =>
            b.LoanType === loanType &&
            b.MaxLoan >= loanAmount &&
            b.MinIncome <= income &&
            b.CIBIL <= cibil
        );
        if (filtered.length < 10)
          filtered = banks.filter((b) => b.LoanType === loanType);

        filtered.forEach((b) => {
          b.Score =
            -b.Rate * 0.4 + -b.Fee * 0.2 + -b.Disbursal * 0.2 + b.Rating * 0.2;
        });

        filtered.sort((a, b) => b.Score - a.Score);
        displayResults(filtered, loanAmount);
      }

      function displayResults(filteredBanks, loanAmount) {
        const container = document.getElementById("resultsContainer");
        container.innerHTML = "";
        if (filteredBanks.length === 0) {
          container.innerHTML =
            "<p>No banks found matching your requirement.</p>";
          return;
        }

        filteredBanks.slice(0, 10).forEach((bank, index) => {
          const calc = calculateEMI(loanAmount, bank.Rate, tenure);
          const card = document.createElement("div");
          card.className = "bank-card";
          const chartId = "chart" + index;

          card.innerHTML = `
            <div class="card-header">
              <h3>${bank.Bank}</h3>
              <span>${bank.LoanType}</span>
            </div>
            <div class="info-grid">
              <div class="info-label">Interest Rate:</div><div>${
                bank.Rate
              }%</div>
              <div class="info-label">Processing Fee:</div><div>${
                bank.Fee
              }%</div>
              <div class="info-label">Disbursal Time:</div><div>${
                bank.Disbursal
              } days</div>
              <div class="info-label">Bank Rating:</div><div>‚≠ê ${
                bank.Rating
              }</div>
              <div class="info-label">Max Loan:</div><div>‚Çπ${bank.MaxLoan.toLocaleString()}</div>
              <div class="info-label">Min Income:</div><div>‚Çπ${bank.MinIncome.toLocaleString()}</div>
              <div class="info-label">CIBIL Required:</div><div>${
                bank.CIBIL
              }</div>
            </div>
            <div class="emi-card">
              <div class="emi-details">
                <h4>EMI Plan (${tenure} Years)</h4>
                <p><strong>Principal:</strong> ‚Çπ${loanAmount.toLocaleString()}</p>
                <p><strong>Interest:</strong> ‚Çπ${calc.interest.toLocaleString()}</p>
                <p><strong>Total Payment:</strong> ‚Çπ${calc.total.toLocaleString()}</p>
                <p><strong>Monthly EMI:</strong> ‚Çπ${calc.emi.toLocaleString()}</p><br/>
                <p>
  <button class="btn secondary" onclick="toggleDocuments(this)">üìÑ View Required Documents</button>
</p>
<div class="document-list" style="display:none; margin-top:10px;"></div>

              </div>
              <div class="emi-chart"><canvas id="${chartId}"></canvas></div>
            </div>
          `;
          container.appendChild(card);

          new Chart(document.getElementById(chartId), {
            type: "doughnut",
            data: {
              labels: ["Principal", "Interest"],
              datasets: [
                {
                  data: [loanAmount, calc.interest],
                  backgroundColor: ["#42a5f5", "#ef5350"],
                },
              ],
            },
            options: { plugins: { legend: { position: "bottom" } } },
          });
        });
      }

      function updateTenure() {
        tenure = parseInt(document.getElementById("tenureInputBox").value) || 5;
        rankLoans();
      }

      function openPopup() {
        document.getElementById("popupForm").style.display = "flex";
        document.getElementById("loanTypeInput").value = loanType;
        document.getElementById("loanAmountInput").value = loanAmount;
        document.getElementById("incomeInput").value = income;
        document.getElementById("cibilInput").value = cibil;
      }
      function closePopup() {
        document.getElementById("popupForm").style.display = "none";
      }
      function applyRequirement() {
        loanType = document.getElementById("loanTypeInput").value;
        loanAmount = parseInt(document.getElementById("loanAmountInput").value);
        income = parseInt(document.getElementById("incomeInput").value);
        cibil = parseInt(document.getElementById("cibilInput").value);
        closePopup();
        rankLoans();
      }

      function toggleDocuments(button) {
        const emiCard = button.closest(".emi-card"); // EMI card div
        const bankCard = button.closest(".bank-card"); // parent bank card
        const docDiv = emiCard.querySelector(".document-list");

        const bankName = bankCard.querySelector(".card-header h3").innerText;
        const loanType = bankCard.querySelector(".card-header span").innerText;

        // Find the bank in the array
        const bankData = bankLoanDocuments.find((b) => b.bank === bankName);

        let docs = ["No documents available"];
        let notes = [];

        if (bankData && bankData.loans[loanType]) {
          docs = bankData.loans[loanType].requiredDocuments;
          notes = bankData.loans[loanType].notes || [];
        }

        if (docDiv.style.display === "none") {
          // Show documents
          docDiv.innerHTML =
            "<strong>Required Documents:</strong><ul><li>" +
            docs.join("</li><li>") +
            "</li></ul>";
          if (notes.length) {
            docDiv.innerHTML +=
              "<strong>Notes:</strong><ul><li>" +
              notes.join("</li><li>") +
              "</li></ul>";
          }
          docDiv.style.display = "block";
          button.innerText = "üìÑ Hide Documents";
        } else {
          docDiv.style.display = "none";
          button.innerText = "üìÑ View Required Documents";
        }
      }

      window.onload = function () {
        // Populate loan types first if needed
        const loanTypeInput = document.getElementById("loanTypeInput");
        const uniqueLoanTypes = [...new Set(banks.map((b) => b.LoanType))];
        uniqueLoanTypes.forEach((type) => {
          const option = document.createElement("option");
          option.value = type;
          option.text = type;
          loanTypeInput.appendChild(option);
        });
        loanTypeInput.value = loanType;

        // Show results immediately
        rankLoans();
      };
    </script>
  </body>
</html>
