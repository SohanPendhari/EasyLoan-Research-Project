<!DOCTYPE html>
<html>
  <head>
    <title>EasyLoan Chat</title>

    <style>
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        padding: 0;
        background: #f2f6fc;
        height: 100vh;
        display: flex;
      }

      /* ---- SIDEBAR ---- */
      .sidebar {
        width: 260px;
        background: #ffffff;
        border-right: 1px solid #e0e0e0;
        padding: 25px 20px;
        display: flex;
        flex-direction: column;
        align-items: center; /* Center all content */
        text-align: center; /* Center text */
        gap: 20px;
        box-shadow: 3px 0 10px rgba(0, 0, 0, 0.07);
      }

      .sidebar h2 {
        font-size: 24px;
        margin: 0;
        color: #0f5fb0;
      }

      /* ---- PRIVACY NOTE ---- */
      .privacy-note {
        margin-top: auto;
        width: 90%;
        background: #eef6ff;
        padding: 16px;
        border-radius: 14px;
        font-size: 14px;
        color: #0f5fb0;
        border-left: 5px solid #0f5fb0;
        line-height: 1.4;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      /* ---- MAIN SECTION ---- */
      .main-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
      }

      .header {
        width: 100%;
        padding: 20px 0;
        background: linear-gradient(135deg, #0f5fb0, #38a3d1);
        color: white;
        font-size: 26px;
        font-weight: 700;
        text-align: center;
        position: relative;
        flex-shrink: 0; /* Prevent header from collapsing */
      }

      /* ---- BACK BUTTON ---- */
      .back-btn {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        padding: 8px 16px;
        background: white;
        color: #0f5fb0;
        border-radius: 30px;
        font-weight: 600;
        text-decoration: none;
        transition: 0.3s;
      }
      .back-btn:hover {
        background: #e3f0ff;
      }

      /* ---- CHAT AREA ---- */
      #chat {
        flex: 1;
        overflow-y: auto;
        padding: 30px 40px;
        background: #f2f6fc;
        display: flex;
        flex-direction: column;
      }

      /* ---- INPUT AREA ---- */
      .input-area-wrapper {
        position: relative;
        width: 100%;
        background: white;
        padding: 12px 0;
        box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.08);
      }
      /* CHAT MESSAGE BUBBLES FIX */
      .message {
        margin: 12px 0;
        max-width: 70%;
        padding: 12px 16px;
        border-radius: 16px;
        font-size: 15px;
        line-height: 1.45;
        animation: bubbleFade 0.25s ease-in-out;
      }

      /* User bubble ‚Äì Right */
      .user {
        background: #cfe8ff;
        color: #003f73;
        margin-left: auto;
        margin-right: 10px;
        border-bottom-right-radius: 5px;
        white-space: pre-wrap;
        line-height: 1.6;
      }

      /* Bot bubble ‚Äì Left */
      .bot {
        background: #ffffff;
        color: #222;
        margin-right: auto;
        margin-left: 10px;
        border-bottom-left-radius: 5px;
        border: 1px solid #e5e5e5;
        white-space: pre-wrap;
        line-height: 1.6;
      }

      /* Bubble fade animation */
      @keyframes bubbleFade {
        from {
          opacity: 0;
          transform: translateY(6px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .input-area {
        width: 70%;
        margin: 0 auto;
        display: flex;
        gap: 10px;
      }

      input {
        flex: 1;
        padding: 14px;
        border-radius: 12px;
        border: 1px solid #ccc;
        outline: none;
        font-size: 16px;
      }

      button {
        padding: 14px 20px;
        border: none;
        background: #0f78d4;
        color: white;
        border-radius: 12px;
        cursor: pointer;
        font-size: 15px;
        font-weight: 600;
      }
      button:hover {
        background: #0d66b4;
        transform: translateY(-2px);
      }
      .typing {
        display: flex;
        gap: 6px;
        background: #ffffff;
        padding: 12px 16px;
        border-radius: 14px;
        margin-left: 10px;
        width: fit-content;
        border: 1px solid #e5e5e5;
        animation: bubbleFade 0.25s ease-in-out;
      }

      .dot {
        width: 8px;
        height: 8px;
        background: #888;
        border-radius: 50%;
        animation: blink 1.4s infinite both;
      }

      .dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes blink {
        0% {
          opacity: 0.3;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0.3;
        }
      }
    </style>
  </head>

  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>EasyLoan</h2>

      <div class="privacy-note">
        üîí <b>Privacy Notice</b><br />
        We do NOT store your chat data.<br />
        Closing or refreshing will permanently delete your conversation.
      </div>
    </div>

    <!-- Main Chat Area -->
    <div class="main-area">
      <div class="header">
        <a href="/home.html" class="back-btn">‚Üê Back</a>
        EasyLoan Chat Assistant
      </div>

      <div id="chat"></div>

      <!-- Input Bar -->
      <div class="input-area-wrapper">
        <div class="input-area">
          <input id="msg" placeholder="Type your message..." />
          <button onclick="sendMsg()">Send</button>
        </div>
      </div>
    </div>

    <script>
      let messages = [];

      function showTyping() {
        const chat = document.getElementById("chat");
        let typing = document.createElement("div");
        typing.id = "typing";
        typing.classList.add("message", "bot");
        typing.innerHTML = `
          <div class="typing">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
        `;
        chat.appendChild(typing);
        chat.scrollTop = chat.scrollHeight;
      }

      function removeTyping() {
        let t = document.getElementById("typing");
        if (t) t.remove();
      }

      async function sendMsg() {
        let input = document.getElementById("msg");
        let text = input.value.trim();
        if (!text) return;

        addMessage("user", text);
        messages.push({ role: "user", content: text });
        input.value = "";

        showTyping();

        const reply = await fetch("http://localhost:5000/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages }),
        });

        const data = await reply.json();

        removeTyping();
        addMessage("bot", data.reply);
        messages.push({ role: "bot", content: data.reply });
      }

      function addMessage(type, text) {
        const chat = document.getElementById("chat");

        text = text
          .replace(/\*\s*\*\*/g, "<b>")
          .replace(/\*\*/g, "</b>")
          .replace(/^\*\s+/gm, "‚Ä¢ ");

        let msg = document.createElement("div");
        msg.classList.add("message", type);
        msg.innerHTML = text;

        chat.appendChild(msg);
        chat.scrollTop = chat.scrollHeight;
      }

      // ENTER = SEND
      document.getElementById("msg").addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
          e.preventDefault();
          sendMsg();
        }
      });
    </script>
  </body>
</html>
